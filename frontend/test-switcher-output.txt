
> frontend@0.0.0 test C:\Users\Cheney\Documents\Github\LearningSong\frontend
> jest "SongSwitcher.integration.test.tsx" "--forceExit"

  console.error
    Error: AggregateError
        at Object.dispatchError (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\xhr\xhr-utils.js:62:19)
        at Request.<anonymous> (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\xhr\XMLHttpRequest-impl.js:655:18)
        at Request.emit (node:events:530:35)
        at ClientRequest.<anonymous> (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\helpers\http-request.js:127:14)
        at ClientRequest.emit (node:events:518:28)
        at emitErrorEvent (node:_http_client:104:11)
        at Socket.socketErrorListener (node:_http_client:518:5)
        at Socket.emit (node:events:518:28)
        at emitErrorNT (node:internal/streams/destroy:170:8)
        at emitErrorCloseNT (node:internal/streams/destroy:129:3)
        at processTicksAndRejections (node:internal/process/task_queues:90:21) {
      type: 'XMLHttpRequest'
    }

      at VirtualConsole.<anonymous> (node_modules/.pnpm/@jest+environment-jsdom-abstract@30.2.0_jsdom@26.1.0/node_modules/@jest/environment-jsdom-abstract/build/index.js:87:23)
      at Object.dispatchError (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/xhr/xhr-utils.js:65:53)
      at Request.<anonymous> (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/xhr/XMLHttpRequest-impl.js:655:18)
      at ClientRequest.<anonymous> (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/helpers/http-request.js:127:14)

  console.error
    Error: AggregateError
        at Object.dispatchError (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\xhr\xhr-utils.js:62:19)
        at Request.<anonymous> (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\xhr\XMLHttpRequest-impl.js:655:18)
        at Request.emit (node:events:530:35)
        at ClientRequest.<anonymous> (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\helpers\http-request.js:127:14)
        at ClientRequest.emit (node:events:518:28)
        at emitErrorEvent (node:_http_client:104:11)
        at Socket.socketErrorListener (node:_http_client:518:5)
        at Socket.emit (node:events:518:28)
        at emitErrorNT (node:internal/streams/destroy:170:8)
        at emitErrorCloseNT (node:internal/streams/destroy:129:3)
        at processTicksAndRejections (node:internal/process/task_queues:90:21) {
      type: 'XMLHttpRequest'
    }

      at VirtualConsole.<anonymous> (node_modules/.pnpm/@jest+environment-jsdom-abstract@30.2.0_jsdom@26.1.0/node_modules/@jest/environment-jsdom-abstract/build/index.js:87:23)
      at Object.dispatchError (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/xhr/xhr-utils.js:65:53)
      at Request.<anonymous> (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/xhr/XMLHttpRequest-impl.js:655:18)
      at ClientRequest.<anonymous> (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/helpers/http-request.js:127:14)

  console.error
    Error: AggregateError
        at Object.dispatchError (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\xhr\xhr-utils.js:62:19)
        at Request.<anonymous> (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\xhr\XMLHttpRequest-impl.js:655:18)
        at Request.emit (node:events:530:35)
        at ClientRequest.<anonymous> (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\helpers\http-request.js:127:14)
        at ClientRequest.emit (node:events:518:28)
        at emitErrorEvent (node:_http_client:104:11)
        at Socket.socketErrorListener (node:_http_client:518:5)
        at Socket.emit (node:events:518:28)
        at emitErrorNT (node:internal/streams/destroy:170:8)
        at emitErrorCloseNT (node:internal/streams/destroy:129:3)
        at processTicksAndRejections (node:internal/process/task_queues:90:21) {
      type: 'XMLHttpRequest'
    }

      at VirtualConsole.<anonymous> (node_modules/.pnpm/@jest+environment-jsdom-abstract@30.2.0_jsdom@26.1.0/node_modules/@jest/environment-jsdom-abstract/build/index.js:87:23)
      at Object.dispatchError (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/xhr/xhr-utils.js:65:53)
      at Request.<anonymous> (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/xhr/XMLHttpRequest-impl.js:655:18)
      at ClientRequest.<anonymous> (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/helpers/http-request.js:127:14)

  console.error
    Error: AggregateError
        at Object.dispatchError (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\xhr\xhr-utils.js:62:19)
        at Request.<anonymous> (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\xhr\XMLHttpRequest-impl.js:655:18)
        at Request.emit (node:events:530:35)
        at ClientRequest.<anonymous> (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\helpers\http-request.js:127:14)
        at ClientRequest.emit (node:events:518:28)
        at emitErrorEvent (node:_http_client:104:11)
        at Socket.socketErrorListener (node:_http_client:518:5)
        at Socket.emit (node:events:518:28)
        at emitErrorNT (node:internal/streams/destroy:170:8)
        at emitErrorCloseNT (node:internal/streams/destroy:129:3)
        at processTicksAndRejections (node:internal/process/task_queues:90:21) {
      type: 'XMLHttpRequest'
    }

      at VirtualConsole.<anonymous> (node_modules/.pnpm/@jest+environment-jsdom-abstract@30.2.0_jsdom@26.1.0/node_modules/@jest/environment-jsdom-abstract/build/index.js:87:23)
      at Object.dispatchError (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/xhr/xhr-utils.js:65:53)
      at Request.<anonymous> (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/xhr/XMLHttpRequest-impl.js:655:18)
      at ClientRequest.<anonymous> (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/helpers/http-request.js:127:14)

  console.error
    Error: AggregateError
        at Object.dispatchError (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\xhr\xhr-utils.js:62:19)
        at Request.<anonymous> (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\xhr\XMLHttpRequest-impl.js:655:18)
        at Request.emit (node:events:530:35)
        at ClientRequest.<anonymous> (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\helpers\http-request.js:127:14)
        at ClientRequest.emit (node:events:518:28)
        at emitErrorEvent (node:_http_client:104:11)
        at Socket.socketErrorListener (node:_http_client:518:5)
        at Socket.emit (node:events:518:28)
        at emitErrorNT (node:internal/streams/destroy:170:8)
        at emitErrorCloseNT (node:internal/streams/destroy:129:3)
        at processTicksAndRejections (node:internal/process/task_queues:90:21) {
      type: 'XMLHttpRequest'
    }

      at VirtualConsole.<anonymous> (node_modules/.pnpm/@jest+environment-jsdom-abstract@30.2.0_jsdom@26.1.0/node_modules/@jest/environment-jsdom-abstract/build/index.js:87:23)
      at Object.dispatchError (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/xhr/xhr-utils.js:65:53)
      at Request.<anonymous> (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/xhr/XMLHttpRequest-impl.js:655:18)
      at ClientRequest.<anonymous> (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/helpers/http-request.js:127:14)

  console.error
    Error: AggregateError
        at Object.dispatchError (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\xhr\xhr-utils.js:62:19)
        at Request.<anonymous> (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\xhr\XMLHttpRequest-impl.js:655:18)
        at Request.emit (node:events:530:35)
        at ClientRequest.<anonymous> (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\helpers\http-request.js:127:14)
        at ClientRequest.emit (node:events:518:28)
        at emitErrorEvent (node:_http_client:104:11)
        at Socket.socketErrorListener (node:_http_client:518:5)
        at Socket.emit (node:events:518:28)
        at emitErrorNT (node:internal/streams/destroy:170:8)
        at emitErrorCloseNT (node:internal/streams/destroy:129:3)
        at processTicksAndRejections (node:internal/process/task_queues:90:21) {
      type: 'XMLHttpRequest'
    }

      at VirtualConsole.<anonymous> (node_modules/.pnpm/@jest+environment-jsdom-abstract@30.2.0_jsdom@26.1.0/node_modules/@jest/environment-jsdom-abstract/build/index.js:87:23)
      at Object.dispatchError (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/xhr/xhr-utils.js:65:53)
      at Request.<anonymous> (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/xhr/XMLHttpRequest-impl.js:655:18)
      at ClientRequest.<anonymous> (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/helpers/http-request.js:127:14)

  console.error
    Error: AggregateError
        at Object.dispatchError (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\xhr\xhr-utils.js:62:19)
        at Request.<anonymous> (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\xhr\XMLHttpRequest-impl.js:655:18)
        at Request.emit (node:events:530:35)
        at ClientRequest.<anonymous> (C:\Users\Cheney\Documents\Github\LearningSong\frontend\node_modules\.pnpm\jsdom@26.1.0\node_modules\jsdom\lib\jsdom\living\helpers\http-request.js:127:14)
        at ClientRequest.emit (node:events:518:28)
        at emitErrorEvent (node:_http_client:104:11)
        at Socket.socketErrorListener (node:_http_client:518:5)
        at Socket.emit (node:events:518:28)
        at emitErrorNT (node:internal/streams/destroy:170:8)
        at emitErrorCloseNT (node:internal/streams/destroy:129:3)
        at processTicksAndRejections (node:internal/process/task_queues:90:21) {
      type: 'XMLHttpRequest'
    }

      at VirtualConsole.<anonymous> (node_modules/.pnpm/@jest+environment-jsdom-abstract@30.2.0_jsdom@26.1.0/node_modules/@jest/environment-jsdom-abstract/build/index.js:87:23)
      at Object.dispatchError (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/xhr/xhr-utils.js:65:53)
      at Request.<anonymous> (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/xhr/XMLHttpRequest-impl.js:655:18)
      at ClientRequest.<anonymous> (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/helpers/http-request.js:127:14)

FAIL tests/SongSwitcher.integration.test.tsx
  Song Switcher Integration Tests
    ??displays song switcher when 2 variations exist (235 ms)
    ??hides song switcher when only 1 variation exists (64 ms)
    ? switches audio URL when variation is selected (1336 ms)
    ??shows active variation indication (107 ms)
    ??disables switcher when song is expired (299 ms)
    ??displays both variations in the switcher (94 ms)
    ??positions switcher near audio player (126 ms)

  ??Song Switcher Integration Tests ??switches audio URL when variation is selected

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 0

    Ignored nodes: comments, script, style
    <html>
      <head />
      <body>
        <div>
          <div
            class="min-h-screen bg-background"
          >
            <nav
              aria-label="Skip links"
              class="sr-only focus-within:not-sr-only"
            >
              <a
                class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary focus:text-primary-foreground focus:rounded-md focus:ring-2 focus:ring-ring focus:ring-offset-2"
                href="#main-content"
              >
                Skip to main content
              </a>
              <a
                class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-48 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary focus:text-primary-foreground focus:rounded-md focus:ring-2 focus:ring-ring focus:ring-offset-2"
                href="#audio-player"
              >
                Skip to audio player
              </a>
            </nav>
            <header
              class="border-b"
              role="banner"
            >
              <div
                class="container mx-auto px-4 py-6"
              >
                <div
                  class="flex items-center justify-between"
                >
                  <div
                    class="text-left"
                  >
                    <h1
                      class="text-3xl font-bold tracking-tight"
                    >
                      LearningSong
                    </h1>
                    <p
                      class="text-muted-foreground mt-1"
                    >
                      Your song is ready to play
                    </p>
                  </div>
                  <div
                    class="flex items-center gap-4"
                  >
                    <nav
                      aria-label="Main navigation"
                      class="flex items-center gap-1 sm:gap-2"
                    >
                      <a
                        aria-current="page"
                        class="px-2 py-1 sm:px-3 sm:py-1.5 text-xs sm:text-sm rounded-md transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground font-medium"
                        data-discover="true"
                        href="/"
                      >
                        <span
                          class="hidden sm:inline"
                        >
                          Text Input
                        </span>
                        <span
                          class="sm:hidden"
                        >
                          Input
                        </span>
                      </a>
                      <a
                        class="px-2 py-1 sm:px-3 sm:py-1.5 text-xs sm:text-sm rounded-md transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 text-muted-foreground"
                        data-discover="true"
                        href="/lyrics-edit"
                      >
                        <span
                          class="hidden sm:inline"
                        >
                          Lyrics Editing
                        </span>
                        <span
                          class="sm:hidden"
                        >
                          Lyrics
                        </span>
                      </a>
                      <a
                        class="px-2 py-1 sm:px-3 sm:py-1.5 text-xs sm:text-sm rounded-md transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 text-muted-foreground"
                        data-discover="true"
                        href="/history"
                      >
                        <span
                          class="hidden sm:inline"
                        >
                          My Songs
                        </span>
                        <span
                          class="sm:hidden"
                        >
                          Songs
                        </span>
                      </a>
                      <a
                        class="px-2 py-1 sm:px-3 sm:py-1.5 text-xs sm:text-sm rounded-md transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 text-muted-foreground"
                        data-discover="true"
                        href="/playback"
                      >
                        <span
                          class="hidden sm:inline"
                        >
                          Song Playback
                        </span>
                        <span
                          class="sm:hidden"
                        >
                          Playback
                        </span>
                      </a>
                    </nav>
                    <div
                      aria-label="Loading rate limit information"
                      aria-live="polite"
                      class="flex items-center space-x-2 text-sm text-muted-foreground"
                      role="status"
                    >
                      <span>
                        Loading rate limit...
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </header>
            <main
              class="container mx-auto px-4 py-8"
              ...

      147 |     await waitFor(() => {
      148 |       const state = useSongPlaybackStore.getState()
    > 149 |       expect(state.primaryVariationIndex).toBe(1)
          |                                           ^
      150 |       // Also verify the button has the aria-current attribute
      151 |       expect(version2Button).toHaveAttribute('aria-current', 'true')
      152 |     })

      at tests/SongSwitcher.integration.test.tsx:149:43
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/.pnpm/@testing-library+dom@10.4.1/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/.pnpm/@testing-library+dom@10.4.1/node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/.pnpm/@testing-library+dom@10.4.1/node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 6 passed, 7 total
Snapshots:   0 total
Time:        5.493 s, estimated 14 s
Ran all test suites matching SongSwitcher.integration.test.tsx.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
?ïŽ¥LIFECYCLE??Test failed. See above for more details.
